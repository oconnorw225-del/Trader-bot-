name: Consolidate Best Parts

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  consolidate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the-basics repository
        uses: actions/checkout@v4
        with:
          ref: ${{ github.ref_name }}

      - name: Clone source repositories
        run: |
          mkdir source
          git clone https://github.com/oconnorw225-del/ndax-quantum-engine.git source/ndax-quantum-engine
          git clone https://github.com/oconnorw225-del/quantum-engine-dashb.git source/quantum-engine-dashb
          git clone https://github.com/oconnorw225-del/shadowforge-ai-trader.git source/shadowforge-ai-trader
          git clone https://github.com/oconnorw225-del/repository-web-app.git source/repository-web-app
          git clone https://github.com/oconnorw225-del/The-new-ones.git source/The-new-ones

      - name: Archive backups
        run: |
          mkdir backups
          tar czf backups/ndax-quantum-engine.tar.gz -C source ndax-quantum-engine
          tar czf backups/quantum-engine-dashb.tar.gz -C source quantum-engine-dashb
          tar czf backups/shadowforge-ai-trader.tar.gz -C source shadowforge-ai-trader
          tar czf backups/repository-web-app.tar.gz -C source repository-web-app
          tar czf backups/The-new-ones.tar.gz -C source The-new-ones

      - name: Setup directory structure
        run: |
          mkdir -p api backend frontend workflows docs automation tests

      - name: Run consolidation script
        run: |
          bash automation/consolidate.sh

      - name: Commit consolidated code
        run: |
          git config --global user.email "ci-bot@example.com"
          git config --global user.name "CI Bot"
          git add .
          git diff --staged --quiet || git commit -m "Automated consolidation of best parts"
          git push
